<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
<!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
<script src="http://localhost:3000/eccrypto-2.js"></script>

</head>
<body>

  <div class="d-flex justify-content-center top-50 start-50 align-items-center  vh-100">
    <div class="row w-75 border rounded p-3 ">
      <div class="col-md-6 d-flex flex-column justify-content-center border-end pe-3 ">
        <!-- <form method="POST" action="/register"> -->
          <h3 class="mb-4">Register</h3>
          <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">Email</span>
            <input type="email" name="email" class="form-control" placeholder="test@example.com" aria-label="Username" aria-describedby="basic-addon1">
          </div>
          <div class="form-floating mb-3">
            <input type="text" name="uname" class="form-control w-100" id="floatingInput" placeholder="username">
            <label for="floatingInput">username</label>
          </div>
          <div class="form-floating">
            <input type="password" name="pw" class="form-control w-100" id="floatingPassword" placeholder="Password">
            <label for="floatingPassword">Password</label>
          </div>
          <div class="form-floating mt-4">
            <input type="button" class="btn btn-dark " value="submit" onclick="submitRegistration(event)">
          </div>
        <!-- </form> -->
      </div>
      <div class="col-md-6 d-flex flex-column justify-content-center ps-3">
        <h3 class="mb-4">Welcome to our website!</h3>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce feugiat sapien a semper malesuada. Aenean auctor diam sed tellus varius, et semper ipsum porttitor. </p>
      </div>
    </div>
  </div>
  
  <script>
    async function submitRegistration(event) {
      event.preventDefault();
      const email = document.querySelector('input[name="email"]').value;
      const uname = document.querySelector('input[name="uname"]').value;
      const pw = document.querySelector('input[name="pw"]').value;
      const data = { email, uname, pw };
      console.log(data)
      var options = {
        method: 'POST',
        body: JSON.stringify(data),
        headers: {
          'Content-Type': 'application/json'
        }
      };
      console.log(options.body)
      const response = await fetch('/register', options);
      const result = await response.json();
      console.log(result);

      if(result.error){
        alert("Email or username not avaiable")
      }else{
        const keys = await generateKeys();
        console.log(keys,JSON.stringify(keys));
        localStorage.setItem("private_key_" + uname,JSON.stringify(keys.privateKey));
        //IMP : this private key is stored in single browser device so for other devices or other browser it wont work while uplaoding a file
        let keyData = {
          uname : uname,
          publicKey : JSON.stringify(keys.publicKey)
        }
        options = {
          method: 'POST',
          body: JSON.stringify(keyData),
          headers: {
            'Content-Type': 'application/json'
          }
        };
        const response = await fetch('/save_publickey', options);
        const result = await response.json();
        console.log(result);
        
        if(!result.error){
          window.location ="/"
        }
      }
   
  }
  </script>
  
</body>
</html> 